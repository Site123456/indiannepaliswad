<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Indian Nepali Swad – Carte en ligne</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    /* =========================================================================
       THEME TOKENS
       ========================================================================= */

    :root {
      --page-max-width: 1080px;

      --radius-xl: 22px;
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-pill: 999px;

      --transition-fast: 0.15s ease-out;
      --transition-med: 0.22s ease-out;

      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;

      /* LIGHT THEME */
      --bg-page: #f8f2ea;
      --bg-surface: #ffffff;
      --bg-soft: #f5ebe0;
      --bg-muted: #f1e3d5;

      --border-subtle: rgba(55, 37, 25, 0.08);
      --border-strong: rgba(55, 37, 25, 0.18);

      --text-main: #322018;
      --text-soft: #8e7b6d;
      --text-mute: #b29b8b;

      --accent: #c4541a;
      --accent-soft: rgba(197, 84, 26, 0.1);
      --accent-strong: #a44110;
      --accent-border: rgba(197, 84, 26, 0.4);

      --price-color: #a44110;

      --chip-bg: #f3e6da;
      --chip-border: rgba(50, 30, 18, 0.16);
      --chip-text: #7b6252;
      --chip-active-bg: #c4541a;
      --chip-active-text: #ffffff;

      --search-bg: #f7ece1;
      --search-border: rgba(50, 30, 18, 0.28);
      --search-placeholder: #b39c8b;

      --item-bg-hover: rgba(197, 84, 26, 0.04);
      --item-border: rgba(50, 30, 18, 0.08);
    }

    :root[data-theme="dark"] {
      --bg-page: #110f10;
      --bg-surface: #181416;
      --bg-soft: #211b1e;
      --bg-muted: #241c1f;

      --border-subtle: rgba(255, 255, 255, 0.06);
      --border-strong: rgba(255, 255, 255, 0.14);

      --text-main: #f6ede4;
      --text-soft: #c3b2a6;
      --text-mute: #9b8776;

      --accent: #ff9442;
      --accent-soft: rgba(255, 148, 66, 0.12);
      --accent-strong: #ffc25e;
      --accent-border: rgba(255, 194, 94, 0.6);

      --price-color: #ffc25e;

      --chip-bg: #22181d;
      --chip-border: rgba(255, 255, 255, 0.14);
      --chip-text: #d1bfb0;
      --chip-active-bg: #ff9442;
      --chip-active-text: #1b0f0b;

      --search-bg: #241c21;
      --search-border: rgba(255, 255, 255, 0.24);
      --search-placeholder: #a38d7c;

      --item-bg-hover: rgba(255, 148, 66, 0.09);
      --item-border: rgba(255, 255, 255, 0.1);
    }

    /* =========================================================================
       BASE
       ========================================================================= */

    *, *::before, *::after {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font-sans);
      background: var(--bg-page);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 16px;
      transition: background var(--transition-med), color var(--transition-med);
    }

    img {
      max-width: 100%;
      display: block;
    }

    button {
      font-family: inherit;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* =========================================================================
       LAYOUT
       ========================================================================= */

    .app {
      width: 100%;
      max-width: var(--page-max-width);
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    @media (min-width: 900px) {
      .app {
        gap: 16px;
      }
    }

    /* =========================================================================
       HEADER (logo + theme + horaires)
       ========================================================================= */

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding-inline: 4px;
    }

    .brand-side {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.16);
      flex-shrink: 0;
    }

    .brand-logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-name {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .brand-sub {
      font-size: 12px;
      color: var(--text-soft);
    }

    .right-side {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .hours-badge {
      display: inline-flex;
      flex-direction: column;
      gap: 2px;
      padding: 6px 10px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      background: var(--bg-soft);
      font-size: 11px;
      color: var(--text-soft);
      min-width: 150px;
    }

    .hours-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .hours-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #1fa463;
      position: relative;
    }

    .status-dot::after {
      content: "";
      position: absolute;
      inset: 2px;
      border-radius: inherit;
      background: #dbf6e7;
    }

    :root[data-theme="dark"] .status-dot::after {
      background: #13261a;
    }

    .hours-label {
      font-size: 11px;
    }

    .hours-now {
      font-weight: 500;
      color: var(--text-main);
    }

    .hours-range {
      font-size: 11px;
      color: var(--text-mute);
    }

    .theme-toggle {
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      background: var(--bg-soft);
      padding: 4px 8px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      font-size: 11px;
      color: var(--text-soft);
      transition: background var(--transition-fast), border-color var(--transition-fast), color var(--transition-fast);
      min-width: 80px;
      justify-content: center;
    }

    .theme-toggle-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #f3cf8c;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #4e2a11;
    }

    :root[data-theme="dark"] .theme-toggle-thumb {
      background: #f7d889;
    }

    .theme-toggle-label {
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    /* =========================================================================
       SHEET
       ========================================================================= */

    .sheet {
      background: var(--bg-surface);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
      padding: 16px 14px 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
      overflow: hidden;
    }

    :root[data-theme="dark"] .sheet {
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.7);
    }

    @media (min-width: 900px) {
      .sheet {
        padding: 20px 22px 22px;
        gap: 16px;
      }
    }

    .sheet-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* =========================================================================
       SHEET TITLE
       ========================================================================= */

    .sheet-header {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-end;
      justify-content: space-between;
      gap: 10px;
    }

    .sheet-title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .sheet-title {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .sheet-subtitle {
      font-size: 12px;
      color: var(--text-soft);
      max-width: 340px;
      line-height: 1.4;
    }

    .sheet-meta {
      font-size: 11px;
      color: var(--text-mute);
      text-align: right;
    }

    /* =========================================================================
       SEARCH & FILTERS
       ========================================================================= */

    .search-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .search-box {
      flex: 1 1 240px;
      min-width: 220px;
      position: relative;
    }

    .search-input {
      width: 100%;
      border-radius: var(--radius-pill);
      border: 1px solid var(--search-border);
      background: var(--search-bg);
      padding: 9px 10px 9px 30px;
      font-size: 14px;
      color: var(--text-main);
      outline: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
    }

    .search-input::placeholder {
      color: var(--search-placeholder);
    }

    .search-input:focus {
      border-color: var(--accent-border);
      box-shadow: 0 0 0 1px var(--accent-border);
      background: #fff9f1;
    }

    :root[data-theme="dark"] .search-input:focus {
      background: #2a2226;
    }

    .search-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
    }

    .search-icon svg {
      width: 14px;
      height: 14px;
      stroke: var(--text-mute);
      stroke-width: 1.7;
      fill: none;
    }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
    }

    .chip {
      border-radius: var(--radius-pill);
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      color: var(--chip-text);
      padding: 4px 10px;
      font-size: 11px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
      white-space: nowrap;
    }

    .chip:hover {
      transform: translateY(-1px);
      border-color: var(--accent-border);
    }

    .chip--active {
      background: var(--chip-active-bg);
      color: var(--chip-active-text);
      border-color: transparent;
    }

    /* =========================================================================
       STATUS
       ========================================================================= */

    .search-status {
      font-size: 11px;
      color: var(--text-mute);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 6px;
    }

    .search-status-left {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .status-dot-small {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
    }

    .status-pill {
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      background: var(--bg-soft);
      padding: 3px 8px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 10px;
    }

    .search-status-right strong {
      color: var(--accent-strong);
    }

    /* =========================================================================
       GRID SECTIONS
       ========================================================================= */

    .sections-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 14px;
    }

    @media (max-width: 840px) {
      .sections-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .sections-column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .section-card {
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      background: var(--bg-soft);
      padding: 10px 10px 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    @media (min-width: 900px) {
      .section-card {
        padding: 12px 12px 10px;
      }
    }

    .section-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
    }

    .section-head-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .section-title {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
    }

    .section-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    .section-count {
      font-size: 11px;
      color: var(--text-mute);
      white-space: nowrap;
    }

    .section-divider {
      height: 1px;
      background: linear-gradient(
        90deg,
        rgba(0, 0, 0, 0.12),
        rgba(0, 0, 0, 0.04) 30%,
        rgba(0, 0, 0, 0.04) 70%,
        rgba(0, 0, 0, 0.12)
      );
      opacity: 0.6;
    }

    :root[data-theme="dark"] .section-divider {
      background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0.16),
        rgba(255, 255, 255, 0.04) 30%,
        rgba(255, 255, 255, 0.04) 70%,
        rgba(255, 255, 255, 0.16)
      );
    }

    .section-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    /* =========================================================================
       MENU ITEM
       ========================================================================= */

    .menu-item {
      position: relative;
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) auto;
      gap: 6px 10px;
      align-items: center;
      border-radius: var(--radius-md);
      padding: 6px 4px;
      border: 1px solid transparent;
      transition: background var(--transition-fast), border-color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast);
      cursor: pointer;
    }

    .menu-item-main {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      min-width: 0;
    }

    .menu-item-media {
      width: 50px;
      height: 50px;
      border-radius: var(--radius-md);
      overflow: hidden;
      background: #f2c18f;
      flex-shrink: 0;
    }

    .menu-item-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform var(--transition-med), opacity var(--transition-med);
    }

    .menu-item-text {
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .menu-item-name {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 500;
    }

    .menu-item-desc {
      font-size: 11px;
      color: var(--text-soft);
      max-width: 320px;
      line-height: 1.4;
    }

    .menu-item-price {
      font-size: 13px;
      font-weight: 600;
      color: var(--price-color);
      text-align: right;
      white-space: nowrap;
    }

    .menu-item::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid transparent;
      pointer-events: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    }

    .menu-item:hover {
      background: var(--item-bg-hover);
      border-color: var(--item-border);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
      transform: translateY(-1px);
    }

    .menu-item:hover::after {
      border-color: var(--accent-border);
      box-shadow: 0 0 0 1px var(--accent-border);
    }

    .menu-item:hover .menu-item-img {
      transform: scale(1.05);
      opacity: 0.96;
    }

    .menu-item-link {
      position: absolute;
      inset: 0;
      z-index: 2;
    }

    @media (max-width: 520px) {
      .menu-item {
        grid-template-columns: minmax(0, 1.5fr) auto;
        padding-inline: 2px;
      }
      .menu-item-media {
        width: 46px;
        height: 46px;
      }
      .menu-item-name {
        font-size: 12px;
      }
      .menu-item-price {
        font-size: 12px;
      }
      .menu-item-desc {
        font-size: 10px;
      }
    }

    /* =========================================================================
       EMPTY NOTICE
       ========================================================================= */

    .empty-notice {
      margin-top: 6px;
      border-radius: var(--radius-md);
      border: 1px dashed var(--border-strong);
      background: var(--bg-soft);
      padding: 8px 10px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .empty-notice strong {
      color: var(--accent-strong);
    }

    .empty-notice small {
      display: block;
      margin-top: 4px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    /* =========================================================================
       FOOTER
       ========================================================================= */

    .sheet-footer {
      font-size: 10px;
      color: var(--text-mute);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 6px;
      padding-top: 4px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .sheet-footer strong {
      color: var(--accent-strong);
    }
  </style>
</head>

<body>
<div class="app">

  <!-- HEADER -->
  <header class="top-bar">
    <div class="brand-side">
      <a href="https://www.indian-nepaliswad.fr/" class="brand-logo" aria-label="Indian Nepali Swad – site officiel">
        <img src="https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png" alt="Indian Nepali Swad logo">
      </a>
      <div class="brand-text">
        <div class="brand-name">Indian Nepali Swad</div>
        <div class="brand-sub">Carte en ligne</div>
      </div>
    </div>

    <div class="right-side">
      <div class="hours-badge" aria-live="polite" id="hoursBadge">
        <div class="hours-line">
          <div class="hours-status">
            <div class="status-dot" id="statusDot" aria-hidden="true"></div>
            <span class="hours-label" id="statusLabel">Chargement…</span>
          </div>
          <span class="hours-now" id="hoursNow"></span>
        </div>
        <div class="hours-range" id="hoursRange">–</div>
      </div>

      <button type="button" class="theme-toggle" id="themeToggle" aria-label="Basculer le thème">
        <div class="theme-toggle-thumb" id="themeThumb">☼</div>
        <span class="theme-toggle-label" id="themeLabel">Jour</span>
      </button>
    </div>
  </header>

  <!-- SHEET -->
  <main class="sheet">
    <div class="sheet-inner">

      <!-- TITLE -->
      <section class="sheet-header">
        <div class="sheet-title-block">
          <h1 class="sheet-title">Carte</h1>
        </div>
        <div class="sheet-meta" id="sheetMeta">
          – 
        </div>
      </section>

      <!-- SEARCH / FILTERS -->
      <section class="search-row" aria-label="Recherche et filtres">
        <div class="search-box">
          <span class="search-icon">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="11" cy="11" r="6.5"></circle>
              <line x1="16" y1="16" x2="20" y2="20"></line>
            </svg>
          </span>
          <input
            id="searchInput"
            class="search-input"
            type="search"
            autocomplete="off"
            placeholder="Rechercher un plat ou une catégorie (naan, menu, curry...)"
          >
        </div>
        <div class="chips-row" id="chipRow">
          <button class="chip chip--active" type="button" data-tag="all">Tout</button>
          <button class="chip" type="button" data-tag="Menu">Menus</button>
          <button class="chip" type="button" data-tag="Entrée">Entrées</button>
          <button class="chip" type="button" data-tag="Curry">Currys</button>
          <button class="chip" type="button" data-tag="Naan">Naans</button>
          <button class="chip" type="button" data-tag="Riz">Riz</button>
          <button class="chip" type="button" data-tag="Végétarien">Végétarien</button>
          <button class="chip" type="button" data-tag="Dessert">Desserts</button>
          <button class="chip" type="button" data-tag="Boisson">Boissons</button>
        </div>
      </section>

      <!-- STATUS -->
      <section class="search-status" aria-live="polite">
        <div class="search-status-left">
          <span class="status-dot-small"></span>
          <span id="resultCountLabel">Toute la carte est affichée.</span>
          <span class="status-pill" id="activeTagLabel">Filtre : Tous les plats</span>
        </div>
        <div class="search-status-right" id="queryInfoLabel">
          Astuce : tapez quelques lettres d’un plat ou d’une catégorie.
        </div>
      </section>

      <!-- GRID -->
      <section class="sections-grid" aria-label="Sections du menu">
        <div class="sections-column" id="leftColumn"></div>
        <div class="sections-column" id="rightColumn"></div>
      </section>

      <!-- EMPTY NOTICE -->
      <div id="emptyNoticeContainer"></div>

      <!-- FOOTER -->
      <footer class="sheet-footer">
        <span>Tarifs en euros • Menu principal</span>
        <span>&copy;2017 - 2026 Indian Nepali Swad</span>
      </footer>
    </div>
  </main>

</div>

<script>
  // ===========================================================================
  // Storage keys & helper
  // ===========================================================================

  const STORAGE_KEYS = {
    THEME: "ins_theme",
    COOKIES: "ins_cookies",
    SEARCHES: "ins_recent_searches",
    SEARCHES_ENABLED: "ins_searches_enabled"
  };

  const storage = {
    get(key, fallback = null) {
      try {
        const raw = localStorage.getItem(key);
        if (raw === null) return fallback;
        return JSON.parse(raw);
      } catch {
        return fallback;
      }
    },
    set(key, value) {
      try {
        localStorage.setItem(key, JSON.stringify(value));
      } catch {
        // ignore
      }
    }
  };

  // ===========================================================================
  // Horaires
  // ===========================================================================

  const horaires = {
    1: ["11:15-14:45", "18:15-22:45"], // lundi
    2: ["11:15-14:45", "18:15-22:45"], // mardi
    3: ["11:15-14:45", "18:15-22:45"], // mercredi
    4: ["11:15-14:45", "18:15-22:45"], // jeudi
    5: ["11:15-14:45", "18:15-22:45"], // vendredi
    6: ["11:15-14:45", "18:15-22:45"], // samedi
    0: ["11:15-14:45", "18:15-22:45"]  // dimanche
  };

  function parseTimeToMinutes(str) {
    const [h, m] = str.split(":").map(Number);
    return h * 60 + m;
  }

  function isNowInRange(rangeStr) {
    const [start, end] = rangeStr.split("-");
    const now = new Date();
    const minutes = now.getHours() * 60 + now.getMinutes();
    const startM = parseTimeToMinutes(start);
    const endM = parseTimeToMinutes(end);
    return minutes >= startM && minutes <= endM;
  }

  function describeTodayHours() {
    const now = new Date();
    const day = now.getDay(); // 0–6
    const todayRanges = horaires[day];

    if (!todayRanges || !todayRanges.length) {
      return {
        open: false,
        label: "Fermé aujourd’hui",
        now: "",
        full: "–"
      };
    }

    const openNow = todayRanges.some(r => isNowInRange(r));
    const label = openNow ? "Ouvert maintenant" : "Fermé pour le moment";
    const prettyRanges = todayRanges.join(" • ");

    let nowLabel = "";
    if (openNow) {
      const minutes = now.getHours() * 60 + now.getMinutes();
      const [currentRange] = todayRanges.filter(r => isNowInRange(r));
      const [, end] = currentRange.split("-");
      nowLabel = `jusqu’à ${end}`;
    } else {
      nowLabel = "voir horaires";
    }

    return {
      open: openNow,
      label,
      now: nowLabel,
      full: `Aujourd’hui : ${prettyRanges}`
    };
  }

  function updateHoursUI() {
    const statusDot = document.getElementById("statusDot");
    const statusLabel = document.getElementById("statusLabel");
    const hoursNow = document.getElementById("hoursNow");
    const hoursRange = document.getElementById("hoursRange");
    const sheetMeta = document.getElementById("sheetMeta");

    const info = describeTodayHours();
    statusLabel.textContent = info.label;
    hoursNow.textContent = info.now;
    hoursRange.textContent = info.full;
    sheetMeta.textContent = info.full;

    statusDot.style.opacity = info.open ? "1" : "0.4";
  }

  // ===========================================================================
  // Theme
  // ===========================================================================

  const themeToggle = document.getElementById("themeToggle");
  const themeThumb = document.getElementById("themeThumb");
  const themeLabel = document.getElementById("themeLabel");

  function applyTheme(theme) {
    const t = theme === "dark" ? "dark" : "light";
    document.documentElement.setAttribute("data-theme", t);
    themeThumb.textContent = t === "dark" ? "☾" : "☼";
    themeLabel.textContent = t === "dark" ? "Soir" : "Jour";
  }

  function initTheme() {
    const stored = storage.get(STORAGE_KEYS.THEME, null);
    if (stored === "dark" || stored === "light") {
      applyTheme(stored);
    } else {
      const prefersDark = window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;
      applyTheme(prefersDark ? "dark" : "light");
    }

    themeToggle.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-theme") === "dark"
        ? "dark"
        : "light";
      const next = current === "dark" ? "light" : "dark";
      applyTheme(next);
      storage.set(STORAGE_KEYS.THEME, next);
    });
  }

  // ===========================================================================
  // Data
  // ===========================================================================

  const products = [
    {name:"Menu Spécial",price:"18,90€",link:"./menu/?q=Menu+Spécial",image:"https://www.indian-nepaliswad.fr/37%20menu%20special.jpg",tag:"Menu"},
    {name:"Menu Best Deal",price:"24,90€",link:"./menu/?q=Menu+Best+Deal",image:"https://www.indian-nepaliswad.fr/39%20menu%20best%20deal.jpg",tag:"Menu"},
    {name:"Menu végétarien",price:"18,90€",link:"./menu/?q=Menu+végétarien",image:"https://www.indian-nepaliswad.fr/menuveg.jpg",tag:"Menu"},
    {name:"Combo sauces",price:"1,00€",link:"./menu/?q=Combo+de+3+sauces",image:"https://www.indian-nepaliswad.fr/42%20sauces.jpg",tag:"Sauce"},
    {name:"Set de couverts",price:"0,50€",link:"./menu/?q=Set+de+couverts",image:"https://www.indian-nepaliswad.fr/10%20naan%20garlic.jpg",tag:"Extra"},
    {name:"Naan fromage",price:"4,90€",link:"./menu/?q=Naan+fromage",image:"https://www.indian-nepaliswad.fr/12 naan fromage.jpg",tag:"Naan"},
    {name:"Garlic naan",price:"4,50€",link:"./menu/?q=Garlic+naan",image:"https://www.indian-nepaliswad.fr/9%20naan%20nepalais.jpg",tag:"Naan"},
    {name:"Naan nature",price:"2,90€",link:"./menu/?q=Naan+nature",image:"https://www.indian-nepaliswad.fr/11 naan nature.jpg",tag:"Naan"},
    {name:"Naan Indian Nepali Swad",price:"6,50€",link:"./menu/?q=Naan+Indian+Nepali+Swad",image:"https://www.indian-nepaliswad.fr/9 naan nepalais.jpg",tag:"Naan"},
    {name:"Keema Naan",price:"6,50€",link:"./menu/?q=Keema+Naan",image:"https://www.indian-nepaliswad.fr/10 naan garlic.jpg",tag:"Naan"},
    {name:"Roti Chapati",price:"3,00€",link:"./menu/?q=Roti+Chapati",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Naan"},
    {name:"Papadam",price:"1,00€",link:"./menu/?q=Papadam",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Naan"},
    {name:"Poulet tandoori",price:"8,50€",link:"./menu/?q=Poulet+tandoori",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Entrée"},
    {name:"Samoussas légumes",price:"7,50€",link:"./menu/?q=Samoussas+légumes",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Entrée"},
    {name:"Samoussas poulet",price:"8,50€",link:"./menu/?q=Samoussas+poulet",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Entrée"},
    {name:"Poulet Tikka",price:"8,90€",link:"./menu/?q=Poulet+Tikka",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Entrée"},
    {name:"Onion Bhaji",price:"6,90€",link:"./menu/?q=Onion+Bhaji",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Entrée"},
    {name:"Pakora",price:"7,50€",link:"./menu/?q=Pakora",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Entrée"},
    {name:"Seekh kebab",price:"8,50€",link:"./menu/?q=Seekh+kebab",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Entrée"},
    {name:"Poulet butter",price:"14,50€",link:"./menu/?q=Poulet+butter",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Poulet Tikka Masala",price:"14,50€",link:"./menu/?q=Poulet+Tikka+Masala",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Madras",price:"13,90€",link:"./menu/?q=Madras",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Shahi korma",price:"14,50€",link:"./menu/?q=Shahi+korma",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Biryani",price:"16,50€",link:"./menu/?q=Biryani",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Riz"},
    {name:"Poulet au curry",price:"12,90€",link:"./menu/?q=Poulet+au+curry",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Palak",price:"13,90€",link:"./menu/?q=Palak",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Agneau Spécial Népali Swad",price:"15,50€",link:"./menu/?q=Agneau+Spécial+Népali+Swad",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Vindaloo",price:"13,90€",link:"./menu/?q=Vindaloo",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Poulet Dahl",price:"13,90€",link:"./menu/?q=Poulet+Dahl",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Curry",price:"12,90€",link:"./menu/?q=Curry",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Agneau Dahl",price:"14,90€",link:"./menu/?q=Agneau+Dahl",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Bharta",price:"13,90€",link:"./menu/?q=Bharta",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Poulet Masala",price:"14,50€",link:"./menu/?q=Poulet+Masala",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Masala",price:"14,50€",link:"./menu/?q=Masala",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Dahl",price:"13,90€",link:"./menu/?q=Dahl",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Curry"},
    {name:"Dahl Tadka",price:"11,90€",link:"./menu/?q=Dahl+Tadka",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Végétarien"},
    {name:"Palak paneer",price:"12,50€",link:"./menu/?q=Palak+paneer",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Végétarien"},
    {name:"Bhaigan bharta",price:"12,90€",link:"./menu/?q=Bhaigan+bharta",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Végétarien"},
    {name:"Légumes biryani",price:"14,50€",link:"./menu/?q=Légumes+biryani",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Riz"},
    {name:"Légumes korma",price:"12,90€",link:"./menu/?q=Légumes+korma",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Végétarien"},
    {name:"Légume curry",price:"10,90€",link:"./menu/?q=Légume+curry",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Végétarien"},
    {name:"Chau-Min poulet",price:"14,90€",link:"./menu/?q=Chau-Min+poulet",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Nouilles"},
    {name:"Chau-Min légumes",price:"13,90€",link:"./menu/?q=Chau-Min+légumes",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Nouilles"},
    {name:"Chau-Min crevettes",price:"16,90€",link:"./menu/?q=Chau-Min+crevettes",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Nouilles"},
    {name:"Chau-Min agneau",price:"15,90€",link:"./menu/?q=Chau-Min+agneau",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Nouilles"},
    {name:"Riz basmati",price:"3,90€",link:"./menu/?q=Riz+basmati",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Riz"},
    {name:"Riz safran",price:"4,40€",link:"./menu/?q=Riz+safran",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Riz"},
    {name:"Matar pulao",price:"5,40€",link:"./menu/?q=Matar+pulao",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Riz"},
    {name:"Suji Halwa",price:"5,90€",link:"./menu/?q=Suji+Halwa",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Dessert"},
    {name:"Gulab Jamun",price:"5,90€",link:"./menu/?q=Gulab+Jamun",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Dessert"},
    {name:"Lassi maison",price:"6,50€",link:"./menu/?q=Lassi+maison",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Boisson"},
    {name:"Lassi Mangue",price:"6,50€",link:"./menu/?q=Lassi+Mangue",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Boisson"},
    {name:"Coca-cola zéro",price:"2,00€",link:"./menu/?q=Coca-cola+zéro",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Boisson"},
    {name:"Coca-cola",price:"2,00€",link:"./menu/?q=Coca-cola",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Boisson"},
    {name:"Ice Tea Pêche",price:"2,00€",link:"./menu/?q=Ice+Tea+Pêche",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Boisson"},
    {name:"Eau plate 50cl",price:"3,00€",link:"./menu/?q=Eau+plate+50cl",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Boisson"},
    {name:"Fanta orange",price:"2,00€",link:"./menu/?q=Fanta+orange",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Boisson"},
    {name:"Set de couverts",price:"0,50€",link:"./menu/?q=Set+de+couverts",image:"https://www.indian-nepaliswad.fr/etc/apple-touch-icon.png",tag:"Extra"}
  ];

  const tagDescriptions = {
    "Menu": "Menus avec entrée, plat et accompagnements.",
    "Entrée": "Entrées chaudes et croustillantes.",
    "Curry": "Currys mijotés, parfaits avec naan ou riz.",
    "Naan": "Pains maison cuits au tandoor.",
    "Riz": "Riz basmati nature ou parfumé.",
    "Végétarien": "Plats sans viande, riches en légumes.",
    "Nouilles": "Nouilles sautées façon indo-népalaise.",
    "Dessert": "Spécialités sucrées.",
    "Boisson": "Boissons fraîches et lassi.",
    "Sauce": "Sauces et accompagnements.",
    "Extra": "Suppléments et couverts."
  };

  const leftTags = ["Menu", "Entrée", "Curry", "Végétarien"];
  const rightTags = ["Naan", "Riz", "Nouilles", "Dessert", "Boisson", "Sauce", "Extra"];

  // ===========================================================================
  // DOM
  // ===========================================================================

  const searchInput = document.getElementById("searchInput");
  const chipRow = document.getElementById("chipRow");
  const leftColumn = document.getElementById("leftColumn");
  const rightColumn = document.getElementById("rightColumn");
  const resultCountLabel = document.getElementById("resultCountLabel");
  const activeTagLabel = document.getElementById("activeTagLabel");
  const queryInfoLabel = document.getElementById("queryInfoLabel");
  const emptyNoticeContainer = document.getElementById("emptyNoticeContainer");

  // ===========================================================================
  // Helpers
  // ===========================================================================

  function normalize(str) {
    return str
      .toString()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "");
  }

  function debounce(fn, delay) {
    let timer;
    return function(...args) {
      clearTimeout(timer);
      timer = setTimeout(() => fn.apply(this, args), delay);
    };
  }

  function groupByTag(items) {
    const map = {};
    for (const item of items) {
      (map[item.tag] || (map[item.tag] = [])).push(item);
    }
    return map;
  }

  // ===========================================================================
  // Filtering
  // ===========================================================================

  let state = {
    tag: "all",
    query: ""
  };

  function filterProducts(list, query, tag) {
    const q = normalize(query.trim());
    const hasQ = q.length > 0;

    return list.filter(item => {
      const tagOk = tag === "all" ? true : item.tag === tag;
      if (!hasQ) return tagOk;

      const nameN = normalize(item.name);
      const tagN = normalize(item.tag);
      return tagOk && (nameN.includes(q) || tagN.includes(q));
    });
  }

  // ===========================================================================
  // Rendering
  // ===========================================================================

  function buildItemHTML(p) {
    const wantDesc = ["Menu", "Curry", "Végétarien", "Nouilles"].includes(p.tag);
    const desc = wantDesc ? (tagDescriptions[p.tag] || "") : "";

    return `
      <article class="menu-item">
        <a class="menu-item-link" href="${p.link}" aria-label="${p.name} – ${p.price}"></a>
        <div class="menu-item-main">
          <div class="menu-item-media">
            <img src="${p.image}" alt="${p.name}" class="menu-item-img">
          </div>
          <div class="menu-item-text">
            <h3 class="menu-item-name">${p.name}</h3>
            ${desc ? `<p class="menu-item-desc">${desc}</p>` : ""}
          </div>
        </div>
        <div class="menu-item-price">${p.price}</div>
      </article>
    `;
  }

  function buildSectionHTML(tag, items) {
    if (!items || !items.length) return "";
    const desc = tagDescriptions[tag] || "";
    const count = items.length;
    return `
      <section class="section-card">
        <header class="section-header">
          <div class="section-head-left">
            <h2 class="section-title">${tag}</h2>
            ${desc ? `<p class="section-subtitle">${desc}</p>` : ""}
          </div>
          <div class="section-count">${count} plat${count > 1 ? "s" : ""}</div>
        </header>
        <div class="section-divider"></div>
        <div class="section-list">
          ${items.map(buildItemHTML).join("")}
        </div>
      </section>
    `;
  }

  function renderMenu(list, query, tag) {
    const grouped = groupByTag(list);
    const leftHTML = leftTags.map(t => buildSectionHTML(t, grouped[t])).join("");
    const rightHTML = rightTags.map(t => buildSectionHTML(t, grouped[t])).join("");
    leftColumn.innerHTML = leftHTML;
    rightColumn.innerHTML = rightHTML;

    // Status
    if (!query && tag === "all") {
      resultCountLabel.textContent = "Toute la carte est affichée.";
      activeTagLabel.textContent = "Filtre : Tous les plats";
      queryInfoLabel.textContent = "Astuce : tapez un nom ou une catégorie pour filtrer.";
    } else {
      resultCountLabel.textContent = `${list.length} résultat${list.length > 1 ? "s" : ""} affiché${list.length > 1 ? "s" : ""}.`;
      const tagLabel = tag === "all" ? "Tous les plats" : tag;
      activeTagLabel.textContent = `Filtre : ${tagLabel}`;
      if (query) {
        queryInfoLabel.innerHTML = `Recherche : <strong>${query}</strong>`;
      } else {
        queryInfoLabel.textContent = "Filtre par catégorie sans texte de recherche.";
      }
    }

    emptyNoticeContainer.innerHTML = "";
  }

  function showEmpty(query) {
    emptyNoticeContainer.innerHTML = `
      <div class="empty-notice">
        <strong>Aucun plat trouvé pour « ${query} ».</strong>
        <small>La carte complète reste affichée pour poursuivre la navigation.</small>
      </div>
    `;
    renderMenu(products, "", "all");
  }

  // ===========================================================================
  // Interaction
  // ===========================================================================

  function applyFilters() {
    const filtered = filterProducts(products, state.query, state.tag);
    if (!filtered.length && (state.query || state.tag !== "all")) {
      showEmpty(state.query);
    } else {
      renderMenu(filtered, state.query, state.tag);
    }
  }

  const debouncedApply = debounce(applyFilters, 130);

  searchInput.addEventListener("input", (e) => {
    state.query = e.target.value;
    debouncedApply();
  });

  chipRow.addEventListener("click", (e) => {
    const chip = e.target.closest(".chip");
    if (!chip) return;
    const tag = chip.dataset.tag || "all";
    state.tag = tag;
    chipRow.querySelectorAll(".chip").forEach(c => c.classList.remove("chip--active"));
    chip.classList.add("chip--active");
    applyFilters();
  });

  function initFromUrl() {
    const params = new URLSearchParams(window.location.search);
    const q = params.get("q");
    if (q) {
      const decoded = decodeURIComponent(q.replace(/\+/g, " "));
      state.query = decoded;
      searchInput.value = decoded;
    }
    applyFilters();
  }

  // ===========================================================================
  // Init
  // ===========================================================================

  initTheme();
  updateHoursUI();
  initFromUrl();
</script>

</body>
</html>
